#!/bin/sh
#
# convert a macpaint file to a 200% scaled png with transparent corners
#

set -e

INPUT=$1

if [ "$INPUT" = "" ]; then
	echo "usage: ${0} <macpaint file>"
	exit 1
fi

WD=`mktemp -d`

cat <<END | b64decode -o "$WD/mask.png"
begin-base64 644 mask.png
iVBORw0KGgoAAAANSUhEUgAABAAAAAKsCAQAAADYGgenAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA
B3RJTUUH5QwQAigYUgF4nQAACVdJREFUeNrt2iEWg1AMAMGE+98ZHAY0gp1RfZUx2Z925805AMBf
7POrw1QAoN4EXv4AkNj6LgAAkG4Br38AyGx+FwAAyHaA1z8ApLa/CwAABAkAABAAAEDB+v0fAFwA
AAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAEAA
AAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAIAA
AAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAB
AAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAC
AAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAE
gBEAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAA
gAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAA
AAEAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAA
AAIAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAA
AAQAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEA
AAgAABAARgAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAI
AABAAAAAAgAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQ
AACAAAAABAAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAg
AAAAAQAACAAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABA
AAAAAgAAEAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACA
AAAABAAAIAAAQAAYAQAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAA
AAQAACAAAAABAAAIAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEA
AAgAAEAAAAACAAAQAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIA
ABAAAIAAAAAEAAAgAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQA
ACAAAAABAAAIAABAAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgA
AEAAAAACAAAQAACAAAAAAWAEACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABA
AAAAAgAAEAAAgAAAAAQAACAAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACA
AAAABAAAIAAAAAEAAAgAAEAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAA
AQAACAAAQAAAAAIAABAAAIAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAA
AgAAEAAAgAAAAAQAACAAAAABAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAA
BAAAIAAAAAEAAAgAAEAAAAACAAAEgBEAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQA
ACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgA
AEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAA
AIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAA
AAABAAAIAABAAAAAAgAAEAAAgAAAAAQAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAA
AAACAAAQAACAAAAABAAAIAAAAAEAAAgAABAARgAAAgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAA
AgAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAABAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAA
BAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAA
CAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAEAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAA
EAAAgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAAIAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAA
IAAAAAEAAAgAAEAAAAACAAAQAACAAAAABAAAIAAAQAAYAQAIAABAAAAAAgAAEAAAgAAAAAQAACAA
AAABAAAIAABAAAAAAgAAEAAAgAAAAAQAACAAAAABAAAIAAAQAACAAAAABAAAIAAAAAEAAAgAAEAA
AAACAAAQAACAAAAABAAAIAAAAAEAAAgAAEAAAAACAAAQAAAgAAAAAQAACAAAQAAAAAIAABAAAIAA
AAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAABAAAAAAgAAEAAAgAAAAAQAACAAAAAB
AAAIAABAAAAAAgAA+MTOzMxpEABQ2v4uAAAQJAAAQAAAAAV7f/I/AADIbH4XAABIXwBcAQAgs/Vd
AAAgfwFwCQCAxLZ3AQCAoAu0GA5PIZ8s9wAAAABJRU5ErkJggg==
====
END

macptopbm "$INPUT" | convert -crop 512x342+0+0 +repage pbm:- $WD/"$INPUT"-cropped.png
convert -alpha transparent $WD/"$INPUT"-cropped.png $WD/"$INPUT"-trans.png
convert $WD/"$INPUT"-trans.png -scale 200% $WD/"$INPUT"-scaled.png
convert $WD/"$INPUT"-scaled.png $WD/mask.png \
	-alpha on -compose copy_opacity -composite $WD/"$INPUT"-final.png
mv $WD/"$INPUT"-final.png "$INPUT".png
rm -r $WD/
